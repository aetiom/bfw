#!/bin/sh
# Install BFW script
#
# dateCreate : 2014-02-11
# version : 3.0.0
# author : bulton-fr <bulton.fr@gmail.com>

taskFail=false
echo '\033[0;33mBFW Install :\033[0m'

## app Directory ##
#Create dir "app"
if [ "$taskFail" = false ] ;then
    echo -n '  > Create app directory ...'

    if mkdir -p app ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

#Create dir "app/config"
if [ "$taskFail" = false ] ;then
    echo -n '  > Create app/config directory ...'

    if mkdir -p app/config ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

#Create dir "app/config/bfw"
if [ "$taskFail" = false ] ;then
    echo -n '  > Create app/config/bfw directory ...'

    if mkdir -p app/config/bfw ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

#Create dir "app/modules"
if [ "$taskFail" = false ] ;then
    echo -n '  > Create app/modules directory ...'

    if mkdir -p app/modules ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi
## END app Directory ##

## src Directory ##
#Create dir "src"
if [ "$taskFail" = false ] ;then
    echo -n '  > Create src directory ...'

    if mkdir -p src ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

#Create dir src/cli
if [ "$taskFail" = false ] ;then
    echo -n '  > Create src/cli directory ...'

    if mkdir -p src/cli ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

#Create dir src/controllers
if [ "$taskFail" = false ] ;then
    echo -n '  > Create src/controllers directory ...'

    if mkdir -p src/controllers ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

#Create dir src/modeles
if [ "$taskFail" = false ] ;then
    echo -n '  > Create src/modeles directory ...'

    if mkdir -p src/modeles ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

#Create dir src/view
if [ "$taskFail" = false ] ;then
    echo -n '  > Create src/view directory ...'

    if mkdir -p src/view ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi
## END src Directory ##

## web Directory ##
#Create dir web
if [ "$taskFail" = false ] ;then
    echo -n '  > Create web directory ...'

    if mkdir -p web ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi
## END web Directory ##

# Define DIR variable to know current directory
if [ "$taskFail" = false ] ;then
    echo -n '  > Search skeleton directory path ...'

    if PHP=`which php` ;then
        if DIR=`$PHP -r "echo dirname(dirname(realpath('$0')));"` ;then
            echo '\033[1;32m Done\033[0m'
        else
            echo '\033[1;31m Fail\033[0m'
            taskFail=true
        fi
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

# Copy .htaccess file to root project directory
if [ "$taskFail" = false ] ;then
    echo -n '  > Copy .htaccess file ...'

    if cp $DIR/install/skeleton/.htaccess web/.htaccess ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

# Copy bfw config file into app/config directory
if [ "$taskFail" = false ] ;then
    echo -n '  > Copy config file ...'

    if cp $DIR/install/skeleton/config.php ./app/config/bfw/config.php ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

if [ "$taskFail" = false ] ;then
    echo -n "  > Copy index.php file into web directory ..."

    if cp $DIR/install/skeleton/index.php web/index.php ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

if [ "$taskFail" = false ] ;then
    echo -n "  > Copy cli.php file into root project directory ..."

    if cp $DIR/install/skeleton/cli.php cli.php ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

if [ "$taskFail" = false ] ;then
    echo -n "  > Copy example cli file into app/cli directory ..."

    if cp $DIR/install/skeleton/cli/exemple.php src/cli/exemple.php ;then
        echo '\033[1;32m Done\033[0m'
    else
        echo '\033[1;31m Fail\033[0m'
        taskFail=true
    fi
fi

echo ''
echo -n '\033[0;33mBFW install status : '
if [ "$taskFail" = false ] ;then
    echo '\033[1;32mSuccess\033[0m'
else
    echo '\033[1;31mFail\033[0m'
fi